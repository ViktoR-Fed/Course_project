import pandas as pd
import pytest


@pytest.fixture
def sample_transactions():
    """Создает тестовый DataFrame с транзакциями"""
    data = {
        "Дата операции": [
            "01.12.2023 12:00:00",  # Декабрь 2023
            "15.01.2024 14:30:00",  # Январь 2024
            "01.02.2024 10:15:00",  # Февраль 2024
            "15.02.2024 16:45:00",  # Февраль 2024
            "01.03.2024 09:00:00",  # Март 2024
            "15.03.2024 18:20:00",  # Март 2024
            "01.04.2024 11:30:00",  # Апрель 2024
            "15.04.2024 13:15:00",  # Апрель 2024
        ],
        "Дата платежа": [
            "02.12.2023",
            "16.01.2024",
            "02.02.2024",
            "16.02.2024",
            "02.03.2024",
            "16.03.2024",
            "02.04.2024",
            "16.04.2024",
        ],
        "Номер карты": [
            "1234**5678",
            "12345678",
            "8765**4321",
            "1234**5678",
            "87654321",
            "1234**5678",
            "8765**4321",
            "1234**5678",
        ],
        "Статус": ["OK"] * 8,
        "Сумма операции": [-100, -200, -50, -150, -75, -125, -80, -180],
        "Кэшбэк": [1.0, 2.0, None, None, 0.5, None, None, 1.8],
        "MCC": ["5411", "5812", "5411", "5812", "5411", "5812", "5411", "5812"],
        "Категория": [
            "Супермаркеты",
            "Рестораны",
            "Супермаркеты",
            "Рестораны",
            "Супермаркеты",
            "Рестораны",
            "Супермаркеты",
            "Рестораны",
        ],
        "Описание": [
            "Покупка в магазине",
            "Обед в ресторане",
            "Покупка продуктов",
            "Ужин в кафе",
            "Супермаркет",
            "Кофейня",
            "Магазин",
            "Ресторан",
        ],
        "Округление на инвесткопилку": [0.0] * 8,
        "Бонусы (включая кэшбэк)": [1.0, 2.0, None, None, 0.5, None, None, 1.8],
    }
    return pd.DataFrame(data)


@pytest.fixture
def transactions_with_invalid_dates():
    """Транзакции с некорректными датами"""
    data = {
        "Дата операции": ["invalid_date", "01.01.2024 12:00:00", "not_a_date"],
        "Дата платежа": ["01.01.2024", "02.01.2024", "03.01.2024"],
        "Номер карты": ["1234****5678"] * 3,
        "Статус": ["OK"] * 3,
        "Сумма операции": [-100, -200, -300],
        "Кэшбэк": [1.0, None, 3.0],
        "MCC": ["5411"] * 3,
        "Категория": ["Супермаркеты"] * 3,
        "Описание": ["Test 1", "Test 2", "Test 3"],
        "Округление на инвесткопилку": [0.0] * 3,
        "Бонусы (включая кэшбэк)": [1.0, None, 3.0],
    }
    return pd.DataFrame(data)


@pytest.fixture
def transactions_with_nulls_in_category():
    """Транзакции с пустыми значениями в категориях"""
    data = {
        "Дата операции": ["01.01.2024 12:00:00", "02.01.2024 14:00:00", "03.01.2024 10:00:00"],
        "Дата платежа": ["02.01.2024", "03.01.2024", "04.01.2024"],
        "Номер карты": ["1234****5678"] * 3,
        "Статус": ["OK"] * 3,
        "Сумма операции": [-100, -200, -300],
        "Кэшбэк": [1.0, None, 3.0],
        "MCC": ["5411", "5812", "5411"],
        "Категория": ["Супермаркеты", None, "Супермаркеты"],
        "Описание": ["Test 1", "Test 2", "Test 3"],
        "Округление на инвесткопилку": [0.0] * 3,
        "Бонусы (включая кэшбэк)": [1.0, None, 3.0],
    }
    return pd.DataFrame(data)


@pytest.fixture
def transactions_mixed_amounts():
    """Транзакции с положительными и отрицательными суммами"""
    data = {
        "Дата операции": ["01.01.2024 12:00:00", "02.01.2024 14:00:00", "03.01.2024 10:00:00"],
        "Дата платежа": ["02.01.2024", "03.01.2024", "04.01.2024"],
        "Номер карты": ["1234****5678"] * 3,
        "Статус": ["OK"] * 3,
        "Сумма операции": [-100, 200, -300],  # Одна положительная сумма
        "Кэшбэк": [1.0, None, 3.0],
        "MCC": ["5411", "5812", "5411"],
        "Категория": ["Супермаркеты", "Супермаркеты", "Супермаркеты"],
        "Описание": ["Покупка", "Пополнение", "Покупка"],
        "Округление на инвесткопилку": [0.0] * 3,
        "Бонусы (включая кэшбэк)": [1.0, None, 3.0],
    }
    return pd.DataFrame(data)

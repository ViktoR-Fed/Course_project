# Проект - Анализатор финансовых операций и инвесткопилка

## В этом проекте реализована система для анализа банковских транзакций, генерации финансовых отчетов и автоматического накопления средств через функцию "Инвесткопилка". Проект включает модули для обработки данных, взаимодействия с внешними API и формирования структурированных отчетов.

## Функционал проекта

### Модуль utils (вспомогательные утилиты)

#### Функции для работы с датами и временем:
get_time() -> str
Возвращает приветствие в зависимости от времени суток: "Доброе утро", "Доброе день", "Доброе вечер", "Доброе ночи"

Пример использования:
greeting = get_time()  # Возвращает "Доброе утро" в период 5:00-11:59
get_date_period(date_time: str, date_format: str = "%Y-%m-%d %H:%M:%S") -> list[str]
Возвращает временной интервал от начала месяца до указанной даты.

Пример использования:
period = get_date_period("2024-03-15 14:30:00")
# Возвращает: ["01.03.2024 00:00:00", "15.03.2024 14:30:00"]
#### Функции для фильтрации данных:
filter_transactions_by_month(transactions: pd.DataFrame, month: int, year: int) -> pd.DataFrame
Фильтрует DataFrame транзакций, оставляя только операции за указанный месяц и год.

Параметры:
- transactions: DataFrame с транзакциями
- month: номер месяца (1-12)
- year: год

get_path_and_period(path_file: str, period_date: list) -> pd.DataFrame
Загружает данные из Excel-файла и фильтрует их по указанному временному периоду.

Параметры:
- path_file: путь к Excel-файлу
- period_date: список из двух дат [начало, конец] в формате "дд.мм.гггг чч:мм:сс"

#### Функции для инвестиционной копилки:
validate_month_format(month: str) -> bool
Проверяет корректность формата месяца (YYYY-MM).

validate_limit(limit: int) -> bool
Проверяет корректность лимита округления (положительное число, кратное 10).

filter_transactions_by_month(transactions: List[Dict], target_month: str) -> List[Dict]
Фильтрует список транзакций по целевому месяцу.

round_amount(amount: float, limit: int) -> float
Округляет сумму до ближайшего кратного limit значения вверх и возвращает разницу.

calculate_investment_for_transactions(transactions: List[Dict], limit: int) -> float
Рассчитывает общую сумму для инвесткопилки из списка транзакций.

prepare_investment_response(month: str, total_investment: float, limit: int) -> str
Подготавливает JSON-ответ с результатами расчета.

calculate_example_investment() -> Dict[str, Any]
Пример расчета из условия задачи.

#### Декораторы:
save_to_file(filename: str) -> Callable
Декоратор для автоматического сохранения результатов функций в Excel-файл.

Пример использования:
@save_to_file("report.xlsx")
def generate_report(data):
    # Логика формирования отчета
    return report_data
### Модуль services 

#### Функции для формирования отчетов:
spending_by_category(transactions: pd.DataFrame, category: str, date: Optional[str] = None) -> pd.DataFrame
Возвращает расходы по выбранной категории за 3 последних месяца от заданной/текущей даты.

get_card(sorted_df: pd.DataFrame) -> list[dict]
Агрегирует данные по банковским картам: суммирует расходы и рассчитывает кэшбэк.

get_top_transactions(sorted_df: pd.DataFrame, get_top: int) -> list[dict]
Возвращает топ транзакций по сумме платежа.

#### Функции для работы с внешними API:
get_currency(pathfile: str) -> list[dict]
Получает актуальные курсы валют через Fixer API.

get_stocks(filepath: str) -> list[dict]
Получает стоимость акций через Polygon API.

### Модуль services 
investment_bank(month: str, transactions: List[Dict[str, Any]], limit: int) -> str
Основная функция сервиса "Инвесткопилка". Выполняет полный цикл расчета:
1. Валидация входных данных
2. Фильтрация транзакций по месяцу
3. Расчет суммы для накопления
4. Формирование JSON-ответа

Пример использования:
transactions = [
    {"Дата операции": "2024-03-15", "Сумма операции": -1712},
    {"Дата операции": "2024-03-20", "Сумма операции": -850}
]
result = investment_bank("2024-03", transactions, 50)
## Установка и запуск

### Клонирование репозитория:
git clone https://github.com/ViktoR-Fed/Course_project.git
cd Course_project

### Настройка API-ключей:
1. Получите ключ на [Fixer.io](https://fixer.io) для доступа к курсам валют
2. Получите ключ на [Polygon.io](https://polygon.io) для данных об акциях
3. Добавьте ключи в переменные окружения или в код


## Тестирование

### Обзор тестирования
Для тестирования используется фреймворк Pytest.

### Покрытие тестами

#### Модуль utils
- Функции работы с датами: тестирование приветствий по времени суток, работы с периодами дат
- Функции фильтрации: тестирование фильтрации транзакций по месяцам, загрузки данных из файлов
- Функции инвесткопилки: тестирование валидации, округления сумм, расчета накоплений
- Декораторы: тестирование сохранения результатов в Excel

#### Модуль services
- Формирование отчетов: тестирование анализа расходов по категориям, агрегации по картам
- Работа с API: тестирование получения курсов валют и стоимости акций (с использованием моков)
- Инвесткопилка: тестирование полного цикла расчета, включая обработку ошибок

### Запуск тестов

#### Все тесты:
pytest tests/ -v

### Ключевые тестовые сценарии

#### Для инвесткопилки:
- ✅ Успешный расчет с корректными данными
- ✅ Валидация некорректного формата месяца
- ✅ Валидация некорректного лимита округления
- ✅ Фильтрация транзакций по месяцу
- ✅ Расчет округления для разных сумм и лимитов
- ✅ Формирование JSON-ответа
- ✅ Обработка ошибок и граничных случаев

#### Для финансовых отчетов:
- ✅ Анализ расходов по категориям
- ✅ Агрегация данных по банковским картам
- ✅ Выбор топ-транзакций
- ✅ Фильтрация данных по периодам
- ✅ Экспорт отчетов в Excel

#### Для работы с API:
- ✅ Получение курсов валют (с моками)
- ✅ Получение стоимости акций (с моками)
- ✅ Обработка ошибок сетевых запросов

# Команда проекта
Viktor Fedotov - Beginner Python developer

*Проект разработан в рамках учебного курса SkyPro*